
![pytest](https://img.shields.io/badge/tests-passing-brightgreen?style=flat-square&logo=pytest)
# wine_prediction

## Estrutura Recomendada

- `src/` ‚Äî C√≥digo-fonte principal do projeto
- `tests/` ‚Äî Testes automatizados
- `dados/` ‚Äî Dados de entrada (csv)
- `graficos/` ‚Äî Sa√≠da de gr√°ficos
- `previsoes/` ‚Äî Sa√≠da de previs√µes
- `requirements.txt` ‚Äî Depend√™ncias
- `.gitignore` ‚Äî Arquivos/pastas ignorados
- `README.md` ‚Äî Documenta√ß√£o

## Como rodar

Veja as instru√ß√µes no in√≠cio deste arquivo para preparar o ambiente, rodar testes e executar o pipeline principal.
# Projeto: Previs√£o da Qualidade de Vinhos com Machine Learning

## üçá Sobre o Projeto

Este projeto aplica **Machine Learning** para prever a **qualidade de vinhos tintos** com base em atributos f√≠sico-qu√≠micos como acidez, pH, √°lcool, entre outros. Ele segue um pipeline completo de ci√™ncia de dados, desde o tratamento de dados at√© a avalia√ß√£o final do modelo.

---

## üß™ Objetivo

Desenvolver e validar um modelo de regress√£o capaz de prever com boa precis√£o a nota de qualidade de vinhos tintos, a partir de dados brutos de composi√ß√£o qu√≠mica.

---

## üß† Etapas do Pipeline

1. **Leitura e an√°lise dos dados (EDA):** visualiza√ß√µes, correla√ß√µes e insights.
2. **Engenharia de atributos:** cria√ß√£o de atributos n√£o lineares (polinomiais, c√∫bicos, logar√≠tmicos e de intera√ß√£o).
3. **Normaliza√ß√£o:** padroniza√ß√£o via Z-score.
4. **Treinamento:** regress√£o linear otimizada via BFGS.
5. **Valida√ß√£o:** k-fold cross-validation.
6. **Avalia√ß√£o externa:** uso de conjunto de teste separado.
7. **Armazenamento do modelo final:** salvando `theta`, `mean`, `std`.
8. **Salvamento das previs√µes:** gera um arquivo CSV com as previs√µes do modelo no conjunto de teste.

---

## üìÅ Estrutura de Pastas

```bash
/
‚îú‚îÄ‚îÄ dados/
‚îÇ   ‚îú‚îÄ‚îÄ winequality-red_treino.csv      # Dados de treino (usado no wine_prediction.py)
‚îÇ   ‚îú‚îÄ‚îÄ winequality-red_teste.csv       # Dados de teste externo (usado no wine_prediction.py)
‚îÇ   ‚îú‚îÄ‚îÄ winequality-red.csv             # C√≥pia do treino ou uni√£o, usado no correlational.py para EDA
‚îÇ   ‚îú‚îÄ‚îÄ winequality-white.csv           # (Opcional) Dados de vinho branco
‚îÇ   ‚îî‚îÄ‚îÄ winequality.names               # Dicion√°rio dos atributos e informa√ß√µes da fonte
‚îÇ
‚îú‚îÄ‚îÄ graficos/
‚îÇ   ‚îî‚îÄ‚îÄ correlation_matrix_features_target.png  # ‚¨ÖÔ∏è IMAGEM GERADA automaticamente pelo correlational.py
‚îÇ   ‚îî‚îÄ‚îÄ dist_features.png               # ‚¨ÖÔ∏è IMAGEM GERADA automaticamente pelo model_tools.py (main)
‚îÇ   ‚îî‚îÄ‚îÄ real_vs_predito_R4.png          # ‚¨ÖÔ∏è IMAGEM GERADA automaticamente pelo model_tools.py (main)
‚îÇ   ‚îî‚îÄ‚îÄ theta_diff.png                  # ‚¨ÖÔ∏è IMAGEM GERADA automaticamente pelo model_tools.py (main)
‚îÇ   ‚îî‚îÄ‚îÄ pred_diff_R{R}.png              # ‚¨ÖÔ∏è IMAGEM(NS) GERADA(S) automaticamente pelo model_tools.py (main)
‚îÇ
‚îú‚îÄ‚îÄ previsoes/                           # ‚¨ÖÔ∏è NOVA PASTA: Cont√©m os resultados das predi√ß√µes em CSV
‚îÇ   ‚îî‚îÄ‚îÄ Y_pred_winequality_red_BFGS.csv # ‚¨ÖÔ∏è ARQUIVO GERADO pelo wine_prediction.py
‚îÇ   ‚îî‚îÄ‚îÄ Y_pred_BFGS_R{R}.csv            # ‚¨ÖÔ∏è ARQUIVOS GERADOS pelo model_tools.py (main)
‚îÇ   ‚îî‚îÄ‚îÄ Y_pred_GD_R{R}.csv              # ‚¨ÖÔ∏è ARQUIVOS GERADOS pelo model_tools.py (main)
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ model_tools.py                  # Fun√ß√µes para normaliza√ß√£o, treino, valida√ß√£o e sele√ß√£o de vari√°veis
‚îÇ   ‚îú‚îÄ‚îÄ wine_prediction.py              # Script principal (treina e avalia o modelo final)
‚îÇ   ‚îú‚îÄ‚îÄ correlational.py                # Gera matriz de correla√ß√£o dos dados para EDA
‚îÇ   ‚îú‚îÄ‚îÄ logger_config.py                # Configura√ß√£o de logging
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py                     # Torna src um pacote Python
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_model_tools.py             # Testes automatizados
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py                     # Torna tests um pacote Python
‚îú‚îÄ‚îÄ modelo_winequality_red.npz          # Modelo salvo (pode ser removido para zerar)
‚îú‚îÄ‚îÄ requirements.txt                    # Depend√™ncias do projeto
‚îî‚îÄ‚îÄ README.md                           # Este arquivo
```

---

## üìà Resultados Obtidos

- **MSE (valida√ß√£o cruzada - 5 folds):** ~0.48
- **MSE (teste externo):** ~0.53

Esses valores mostram que o modelo generaliza bem e possui baixo erro quadr√°tico.

---

## üìä correlational.py: An√°lise Explorat√≥ria de Dados (EDA)

Este script gera a matriz de correla√ß√£o entre os atributos (incluindo as features engenheiradas) e a qualidade:

- **Arquivo gerado:** `graficos/correlation_matrix_features_target.png`
- Usa `seaborn` para visualiza√ß√£o.
- Mostra as rela√ß√µes mais fortes com a vari√°vel alvo.

**Observa√ß√£o Importante:** Este script tenta carregar `dados/winequality-red.csv`. Se este arquivo n√£o existir, ele usar√° `dados/winequality-red_treino.csv` e emitir√° um aviso. Recomenda-se ter `dados/winequality-red.csv` (pode ser uma c√≥pia ou uni√£o dos dados de treino/teste) para a an√°lise completa.

---

## ‚öôÔ∏è model_tools.py: Fun√ß√µes Auxiliares e Pipeline de Sele√ß√£o de Vari√°veis

Este m√≥dulo cont√©m as principais fun√ß√µes reutilizadas no pipeline, al√©m de um pipeline `main()` secund√°rio focado na sele√ß√£o de vari√°veis e compara√ß√£o entre otimizadores (BFGS e GD).

| Fun√ß√£o                      | Descri√ß√£o                                                             |
|-----------------------------|----------------------------------------------------------------------|
| `load_csv(path)`            | L√™ arquivos CSV no formato NumPy (para uso geral)                    |
| `create_nonlinear_features(X)` | Gera atributos polinomiais (x¬≤, x¬≥, log(x), x1x2...)            |
| `normalize(X)`              | Aplica Z-score e retorna mean e std para reuso                       |
| `add_bias(X)`               | Adiciona termo de intercepto (coluna de 1s)                          |
| `fit_bfgs(Xb, y)`           | Ajusta modelo via minimiza√ß√£o BFGS (scipy)                           |
| `fit_gd(Xb, y, ...)`        | Ajusta modelo via Gradient Descent (implementa√ß√£o pr√≥pria)            |
| `kfold_mse(X, y, k, fit)`   | Realiza valida√ß√£o cruzada (k-fold)                                   |
| `best_subset_by_R(...)`     | Seleciona o melhor subconjunto de R features via CV                  |

**Exportar para as Planilhas:**  
O `main()` dentro de `model_tools.py` pode ser executado para explorar a sele√ß√£o de vari√°veis e gerar gr√°ficos adicionais (`dist_features.png`, `theta_diff.png`, `pred_diff_R{R}.png`, `real_vs_predito_R4.png`) e salvar previs√µes para cada subconjunto (`Y_pred_BFGS_R{R}.csv`, `Y_pred_GD_R{R}.csv`).

---

## üß™ wine_prediction.py: Pipeline de Treinamento e Avalia√ß√£o Principal

Este √© o script principal para treinar o modelo de regress√£o com todas as features engenheiradas e avaliar seu desempenho no conjunto de teste externo. Ele √© respons√°vel por:

- Carregar os dados de treino e teste.
- Gerar os atributos polinomiais (e outros).
- Normalizar os dados usando as estat√≠sticas do conjunto de treino.
- Treinar o modelo com BFGS.
- Realizar 5-fold CV.
- Avaliar o modelo no conjunto de teste externo.
- Salvar o modelo como `modelo_winequality_red.npz`.
- Salvar as previs√µes do modelo treinado no arquivo `Y_pred_winequality_red_BFGS.csv` dentro da pasta `previsoes/`.

---

## üõ†Ô∏è Como Executar

Para rodar o projeto, siga estes passos no seu terminal:

**1. Clone o reposit√≥rio:**
```bash
git clone https://github.com/RaFeltrim/wine_prediction.git
cd wine_prediction
```

**2. Crie e ative um ambiente virtual (recomendado):**
```bash
python -m venv venv
# No Windows:
.\venv\Scripts\activate
# No macOS/Linux:
source venv/bin/activate
```

**3. Instale as depend√™ncias:**
```bash
pip install -r requirements.txt
```

**4. Prepare o arquivo de dados para a an√°lise de correla√ß√£o (se winequality-red.csv n√£o existir):**  
Para evitar `FileNotFoundError` no correlational.py, voc√™ pode copiar o arquivo de treino:
```bash
copy dados\winequality-red_treino.csv dados\winequality-red.csv  # No Windows
# ou
cp dados/winequality-red_treino.csv dados/winequality-red.csv    # No macOS/Linux
```

**5. Execute os scripts principais:**

- Para gerar a matriz de correla√ß√£o (EDA):
  ```bash
  python -m src.correlational
  ```
  *(A imagem ser√° salva em graficos/)*

- Para treinar o modelo principal, avaliar e salvar suas previs√µes:
  ```bash
  python -m src.wine_prediction
  ```
  *(Os par√¢metros do modelo ser√£o salvos em modelo_winequality_red.npz e as previs√µes em previsoes/)*

- Opcional: Para executar o pipeline de sele√ß√£o de vari√°veis e gerar gr√°ficos e previs√µes adicionais (para cada R):
  ```bash
  python -m src.model_tools
  ```
  *(Gr√°ficos em graficos/ e previs√µes detalhadas em previsoes/Y_pred_BFGS_R{R}.csv e Y_pred_GD_R{R}.csv)*

---

## üìå Requisitos

- Python 3.8+
- Bibliotecas:
  - numpy
  - pandas
  - matplotlib
  - seaborn
  - scipy

‚úÖ Todas est√£o listadas em `requirements.txt`.

---

## üìö Base de Dados

- **Fonte:** UCI Machine Learning Repository, conforme descrito em [Cortez et al., 2009].
- **Cita√ß√£o:**  
  Se for usar este banco de dados, por favor, inclua esta cita√ß√£o:

  > P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.  
  > Modeling wine preferences by data mining from physicochemical properties.  
  > In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.  
  > Dispon√≠vel em: [@Elsevier](http://dx.doi.org/10.1016/j.dss.2009.05.016)

- **Notas de qualidade:** 0 a 10 (valores reais entre 3 e 8)
- **Atributos:** 11 colunas f√≠sico-qu√≠micas de entrada + 1 coluna de sa√≠da (`quality`)
- **Valores Ausentes:** Nenhuma vari√°vel possui valores ausentes.
- **Correla√ß√£o entre Atributos:** V√°rios atributos podem ser correlacionados, o que torna a engenharia e sele√ß√£o de features uma etapa importante.

---

## ‚ú® Melhorias Futuras

- Incluir modelos mais robustos (Random Forest, XGBoost, SVR)
- Adicionar regulariza√ß√£o (Ridge, Lasso)
- Explicabilidade com SHAP/Permutation Importance para entender a contribui√ß√£o de cada feature
- Interface Web para uso interativo
- Refinar a sele√ß√£o de vari√°veis (`best_subset_by_R`) para ser mais eficiente e talvez din√¢mica, n√£o dependendo de √≠ndices hardcoded
- Considerar otimiza√ß√£o de hiperpar√¢metros

---

## üéØ Motiva√ß√£o Pessoal

> ‚ÄúEscolhi esse projeto por causa do meu amor por vinhos e pela diversidade que eles representam. Queria unir essa paix√£o com meu interesse por tecnologia, criando uma IA capaz de avaliar produtos sensoriais com base em dados.‚Äù  
> ‚Äî Rafael Feltrim

---

## üôã‚Äç‚ôÇÔ∏è Autores

- **Rafael Feltrim** ‚Äî [@RaFeltrim](https://github.com/RaFeltrim)
- **Gustavo** ‚Äî Men√ß√£o Honrosa 

---

## üí° Licen√ßa

Este projeto est√° sob a Licen√ßa MIT. Consulte o arquivo `LICENSE`.

> "A melhor forma de aprender √© ensinar. Compartilhe este projeto se ele te ajudou!"